<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../../styles/signIn_styles.css">
</head>

<body>
    <div class="header">
        <div class="container">
            <div class="hamburger-menu">
                <input id="menu__toggle" type="checkbox" />
                <label class="menu__btn" for="menu__toggle">
                  <span></span>
                </label>
                <ul class="menu__box">
                  <li><a class="menu__item" href="../../index.html">Головна</a></li>
                  <li><a class="menu__item" href="../../pages/ukr/page2.html">Теорія та тести</a></li>
                  <li><a class="menu__item" href="../../pages/ukr/vm_page.html">Віртуальна машина</a></li>
                </ul>
            </div>
            <div class="lang">
                <a href="../../pages/ukr/signIn_page.html" class="link">UA</a>
                <a href="#" class="link active">ENG</a>
            </div>
        </div>
    </div>


    <div class="main">
        <div class="row"> <form action="/action_page.php">
            <div class="container">
              <h1>SIGN IN</h1>
              <p>Please, fill out these forms to sign in.</p>
              <hr>
          
              <label for="email"><b>Email</b></label>
              <input type="text" placeholder="Enter email" name="email" id="email" required>
          
              <label for="psw"><b>Password</b></label>
              <input type="password" placeholder="Введіть пароль" name="psw" id="psw" required>
          
              <hr>
              <button type="submit" class="loginbtn">Sign In</button>
            </div>
            
            <div class="container signin">
              <p>Don't have an account yet? <a href="../../pages/eng/signUp_page.eng.html">Sign Up</a>.</p>
            </div>
          </form>
        </div>
    </div>

    <div class="footer">
        <div class="text">Our contacs:</div>
        <div class="text">Email: nazarcherneha05@gmail.com</div>
        <div class="text">Phone number: 098-643-17</div>
    </div>
</body>

<script type="module">
 
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getDatabase, set, ref, update } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
  
    const firebaseConfig = {
      apiKey: "AIzaSyDxOpwVawjWr8F8I2xl4Wm_Hpe0YN9rX9c",
      authDomain: "authentication-app-41a36.firebaseapp.com",
      databaseURL: "https://authentication-app-41a36-default-rtdb.firebaseio.com",
      projectId: "authentication-app-41a36",
      storageBucket: "authentication-app-41a36.appspot.com",
      messagingSenderId: "608523376965",
      appId: "1:608523376965:web:afc20b2c57c31c79cd462c"
    };
  
  
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    const auth = getAuth();
  
    document.addEventListener('DOMContentLoaded', () => {
      const signUpButton = document.querySelector('.registerbtn');
  
      signUpButton.addEventListener('click', (e) => {
          e.preventDefault();
  
          var email = document.getElementById('email').value;
          var password = document.getElementById('psw').value;
          var repeatPassword = document.getElementById('psw-repeat').value;
  
          createUserWithEmailAndPassword(auth, email, password)
              .then((userCredential) => {
                  
                  const user = userCredential.user;
  
                  set(ref(database, 'users/' + user.uid), {
                      email: email
                  })
  
                  alert('User created!');
                 
              })
              .catch((error) => {
                  const errorMessage = error.message;
                  alert(errorMessage);
                  
              });
      });
  });

    document.addEventListener('DOMContentLoaded', () => {
        const signInButton = document.querySelector('.loginbtn');
        signInButton.addEventListener('click', (e) => {
            e.preventDefault();

        var email = document.getElementById('email').value;
        var password = document.getElementById('psw').value;

                signInWithEmailAndPassword(auth, email, password)
                .then((userCredential) => {
  
                    const user = userCredential.user;

                    const dt = new Date();
                    update(ref(database, 'users/' + user.uid), {
                        last_login: dt
                    })

                    alert('User logged in!');
        
                })
                .catch((error) => {
                    const errorCode = error.code;
                    const errorMessage = error.message;

                    alert(errorMessage);

                    window.location.href = "../../pages/eng/MainPage.eng.html";
                });
            });
    });

    const user = auth.currentUser;
    onAuthStateChanged(auth, (user) => {
        if (user) {
          const uid = user.uid;

        } else {

        }
      });

    
    
  </script>

</html>